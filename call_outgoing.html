<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Outbound Call</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.0/css/bulma.min.css">
<meta name="referrer" content="no-referrer" />
</head>
<body>

<div class="card" style="width: 100%; height: 100%">
    <div class="card-content">
        <div class="content">

            <form method="POST" action="" class="box">
                <div class="field">
                    <label class="label" for="to_number">Telefonnummer:</label>
                    <div class="control">
                        <input class="input" type="text" id="to_number" name="to_number" placeholder="echte Rufnummer" required>
                    </div>
                </div>

                <div class="field">
                    <label class="label" for="kunden_name">Name des Kunden:</label>
                    <div class="control">
                        <input class="input" type="text" id="kunden_name" name="kunden_name" placeholder="Demo Name" required>
                    </div>
                </div>

                <div class="field">
                    <label class="label" for="anrufgrund">Anrufgrund:</label>
                    <div class="control">
                        <div class="select">
                            <select id="anrufgrund" name="anrufgrund" required>
                                <option value="3ds">3DS Abbruch</option>
                                <option value="kartenpruefnummer">Kartenprüfnummer falsch</option>
                                <option value="pin">PIN falsch</option>
                                <option value="limit">Limit überschritten</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="field">
                    <div class="control">
                        <button class="button is-primary" type="button" onclick="start_call()">Absenden</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function start_call () {

        // Auslesen aller Formularfelder
        var telefonnummer = document.getElementById("to_number").value.trim();
        var kunden_name = document.getElementById("kunden_name").value.trim();
        var anrufgrund = document.getElementById("anrufgrund").value.trim();

        // Validierung: Überprüfen, ob alle Felder ausgefüllt sind
        if (!telefonnummer || !kunden_name || !anrufgrund) {
            alert("Bitte füllen Sie alle Felder aus.");
            return false;
        }

        var details = {
            'telefonnummer': telefonnummer,
            'kunden_name': kunden_name,
            'anrufgrund': anrufgrund,
        };

        var DBBody = [];
        for (var property in details) {
            var encodedKey = encodeURIComponent(property);
            var encodedValue = encodeURIComponent(details[property]);
            DBBody.push(encodedKey + "=" + encodedValue);
        }
        DBBody = DBBody.join("&");

        // Erzeugen des POST-Requests
        request = new XMLHttpRequest();

        request.open("POST", "https://landlusthotel.de/dialog/call_outgoing_backend.php?id=48156389451123", false);
        request.setRequestHeader("content-type", "application/x-www-form-urlencoded");
        request.setRequestHeader("accept", "application/json");
        request.send(DBBody);

        if (request.status >= 200 && request.status < 300) {
            // ok Meldung an Kunden
            alert("Der Anruf wird jetzt gestartet. Bitte warten Sie einen Moment.");
            return true;
        } else {
            return false;
        }
    }
</script>